<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prompt Enhancer — AI-Powered Prompt Engineering</title>
  <meta name="description" content="Transform rough prompts into structured, production-ready prompts using AI. Free and open source." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>✦</text></svg>" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-deep: #060f0a;
      --bg-card: #0c1a13;
      --border: #1a2e22;
      --border-light: #152a1e;
      --green-dim: #2a4a38;
      --green-muted: #3a5a48;
      --green-mid: #5a8a6e;
      --green-text: #6b9a80;
      --green-bright: #86efac;
      --green-accent: #22c55e;
      --green-dark: #15803d;
      --green-darker: #16a34a;
      --text: #d0d8e0;
      --text-light: #c8e0d4;
      --text-heading: #c8f7dc;
      --text-bold: #e0f5e8;
      --code-bg: #0d1a14;
      --code-border: #1e3a2a;
      --code-text: #7ddfb0;
      --code-block-text: #a8c4b8;
      --error-bg: #1a0f0f;
      --error-border: #3a1a1a;
      --error-text: #f87171;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(160deg, var(--bg-deep) 0%, #0a1610 40%, #081210 100%);
      font-family: 'DM Sans', 'Segoe UI', system-ui, sans-serif;
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem 3rem;
    }

    /* Header */
    .header { text-align: center; margin-bottom: 2rem; max-width: 600px; }
    .header-row { display: inline-flex; align-items: center; gap: 0.6rem; margin-bottom: 0.8rem; }
    .logo {
      width: 36px; height: 36px; border-radius: 10px;
      background: linear-gradient(135deg, var(--green-dark), var(--green-accent));
      display: flex; align-items: center; justify-content: center;
      font-size: 1.1rem; box-shadow: 0 0 20px rgba(34,197,94,0.25);
    }
    h1 {
      font-size: 1.6rem; font-weight: 700; letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--green-bright), var(--green-accent));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .subtitle { color: var(--green-mid); font-size: 0.92rem; line-height: 1.5; }

    /* API Key Banner */
    .api-banner {
      width: 100%; max-width: 720px;
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 14px; padding: 1rem 1.2rem; margin-bottom: 1.2rem;
      display: flex; flex-direction: column; gap: 0.6rem;
    }
    .api-banner label {
      font-size: 0.78rem; font-weight: 600; color: var(--green-mid);
      text-transform: uppercase; letter-spacing: 0.08em;
    }
    .api-row { display: flex; gap: 0.5rem; }
    .api-input {
      flex: 1; background: var(--code-bg); border: 1px solid var(--code-border);
      border-radius: 8px; padding: 0.55rem 0.8rem; color: var(--text-light);
      font-family: 'JetBrains Mono', monospace; font-size: 0.82rem;
      outline: none; transition: border-color 0.2s;
    }
    .api-input:focus { border-color: var(--green-dark); }
    .api-input::placeholder { color: var(--green-dim); }
    .api-hint {
      font-size: 0.75rem; color: var(--green-muted); line-height: 1.4;
    }
    .api-hint a { color: var(--green-text); text-decoration: underline; }

    /* Save button for API key */
    .api-save-btn {
      background: var(--green-dark); border: none; border-radius: 8px;
      padding: 0.55rem 1rem; color: #fff; font-size: 0.82rem; font-weight: 600;
      cursor: pointer; transition: all 0.2s; white-space: nowrap;
    }
    .api-save-btn:hover { filter: brightness(1.15); }
    .api-save-btn.saved { background: var(--code-border); color: var(--green-text); }

    /* Main container */
    .main { width: 100%; max-width: 720px; display: flex; flex-direction: column; gap: 1.2rem; }

    /* Card */
    .card {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 14px; padding: 1.2rem; transition: border-color 0.2s;
    }
    .card-header {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.6rem;
    }
    .card-label {
      font-size: 0.78rem; font-weight: 600; color: var(--green-mid);
      text-transform: uppercase; letter-spacing: 0.08em;
    }
    .char-count {
      font-size: 0.75rem; color: var(--green-muted);
      font-family: 'JetBrains Mono', monospace;
    }

    /* Textarea */
    textarea {
      width: 100%; background: transparent; border: none; outline: none;
      color: var(--text-light); font-size: 0.95rem; line-height: 1.7;
      resize: vertical; font-family: 'DM Sans', system-ui, sans-serif;
      min-height: 120px;
    }
    textarea::placeholder { color: var(--green-dim); }

    /* Footer bar in input card */
    .input-footer {
      display: flex; justify-content: space-between; align-items: center;
      margin-top: 0.6rem; padding-top: 0.6rem; border-top: 1px solid var(--border-light);
    }
    .shortcut-hint { font-size: 0.75rem; color: var(--green-muted); }

    /* Enhance button */
    .enhance-btn {
      background: linear-gradient(135deg, var(--green-dark), var(--green-darker));
      color: #fff; border: none; border-radius: 10px;
      padding: 0.6rem 1.4rem; font-size: 0.88rem; font-weight: 600;
      cursor: pointer; display: flex; align-items: center; gap: 0.5rem;
      transition: all 0.2s; box-shadow: 0 0 16px rgba(34,197,94,0.2);
    }
    .enhance-btn:hover:not(:disabled) { filter: brightness(1.12); }
    .enhance-btn:disabled {
      background: linear-gradient(135deg, #1a3a28, #1e4a30);
      color: var(--green-mid); cursor: not-allowed; box-shadow: none;
    }
    .enhance-btn.no-input { opacity: 0.5; }

    /* Spinner */
    .spinner {
      display: inline-block; width: 14px; height: 14px;
      border: 2px solid #3a6a4e; border-top-color: #6ddf9e;
      border-radius: 50%; animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Error */
    .error {
      background: var(--error-bg); border: 1px solid var(--error-border);
      border-radius: 10px; padding: 0.8rem 1rem;
      color: var(--error-text); font-size: 0.88rem;
    }

    /* Result */
    .result-card { animation: fadeIn 0.4s ease; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .copy-btns { display: flex; gap: 0.5rem; }
    .copy-btn {
      background: #132a1d; border: 1px solid var(--code-border);
      border-radius: 8px; padding: 0.35rem 0.8rem;
      color: var(--green-text); font-size: 0.76rem; font-weight: 500;
      cursor: pointer; transition: all 0.2s;
    }
    .copy-btn:hover { filter: brightness(1.15); }
    .copy-btn.copied { background: var(--green-dark); color: #fff; }

    /* Markdown rendered output */
    .md h2 { font-size: 1.2rem; font-weight: 700; color: var(--text-heading); margin-top: 1.2rem; margin-bottom: 0.4rem; }
    .md h3 { font-size: 1.05rem; font-weight: 700; color: var(--text-heading); margin-top: 1.2rem; margin-bottom: 0.4rem; letter-spacing: 0.01em; }
    .md p { margin: 0.2rem 0; color: var(--text); line-height: 1.7; }
    .md ul { margin: 0.3rem 0; padding-left: 1.4rem; }
    .md li { margin-bottom: 0.25rem; color: var(--text); line-height: 1.6; }
    .md hr { border: none; border-top: 1px solid var(--code-border); margin: 1rem 0; }
    .md strong { color: var(--text-bold); font-weight: 600; }
    .md code {
      background: var(--code-bg); padding: 0.15rem 0.4rem; border-radius: 4px;
      font-size: 0.88em; color: var(--code-text); border: 1px solid var(--code-border);
      font-family: 'JetBrains Mono', monospace;
    }
    .md pre {
      background: var(--code-bg); border: 1px solid var(--code-border);
      border-radius: 8px; padding: 0.8rem 1rem; margin: 0.5rem 0;
      overflow-x: auto; font-size: 0.85rem; line-height: 1.6;
      color: var(--code-block-text); font-family: 'JetBrains Mono', monospace;
    }
    .md .spacer { height: 0.4rem; }

    /* Empty state */
    .empty-state {
      text-align: center; padding: 2.5rem 1rem;
      color: var(--green-dim); font-size: 0.88rem;
    }
    .empty-icon { font-size: 2rem; margin-bottom: 0.6rem; opacity: 0.5; }

    /* Footer */
    .footer {
      margin-top: 3rem; text-align: center;
      font-size: 0.75rem; color: var(--green-muted);
    }
    .footer a { color: var(--green-text); text-decoration: none; }
    .footer a:hover { text-decoration: underline; }

    /* Responsive */
    @media (max-width: 500px) {
      body { padding: 1.2rem 0.6rem; }
      h1 { font-size: 1.3rem; }
      .api-row { flex-direction: column; }
      .copy-btns { flex-wrap: wrap; }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="header">
    <div class="header-row">
      <div class="logo">✦</div>
      <h1>Prompt Enhancer</h1>
    </div>
    <p class="subtitle">
      Transform rough prompts into structured, production-ready prompts using AI. Free &amp; open source.
    </p>
  </div>

  <!-- API Key -->
  <div class="api-banner" id="apiBanner">
    <label>Anthropic API Key</label>
    <div class="api-row">
      <input
        type="password"
        class="api-input"
        id="apiKeyInput"
        placeholder="sk-ant-api03-..."
        autocomplete="off"
      />
      <button class="api-save-btn" id="apiSaveBtn" onclick="saveApiKey()">Save</button>
    </div>
    <p class="api-hint">
      Your key is stored only in your browser's localStorage and never sent anywhere except Anthropic's API.
      Get one at <a href="https://console.anthropic.com/settings/keys" target="_blank" rel="noopener">console.anthropic.com</a>.
    </p>
  </div>

  <!-- Main -->
  <div class="main">
    <!-- Input -->
    <div class="card">
      <div class="card-header">
        <span class="card-label">Your Prompt</span>
        <span class="char-count" id="charCount">0 chars</span>
      </div>
      <textarea
        id="promptInput"
        placeholder="e.g. Write me a blog post about AI trends in 2025..."
        rows="6"
      ></textarea>
      <div class="input-footer">
        <span class="shortcut-hint">⌘/Ctrl + Enter to enhance</span>
        <button class="enhance-btn no-input" id="enhanceBtn" onclick="enhance()" disabled>
          ✦ Enhance
        </button>
      </div>
    </div>

    <!-- Error -->
    <div class="error" id="errorBox" style="display:none;"></div>

    <!-- Result -->
    <div id="resultArea"></div>

    <!-- Empty state -->
    <div class="empty-state" id="emptyState">
      <div class="empty-icon">✦</div>
      Your enhanced prompt will appear here
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    Built with Claude · <a href="https://github.com/" target="_blank" rel="noopener">View on GitHub</a>
  </div>

  <script>
    // ─── Config ──────────────────────────────────────────────
    const SYSTEM_PROMPT = `You are a Prompt Engineering Expert.
Your task is to rewrite the user's input into a high-quality, production-ready prompt
that can be given to a large language model to get the best possible result.

IMPORTANT RULES:
- Do NOT answer or solve the task.
- Do NOT add fictional details.
- Preserve the user's original intent.
- Make the prompt clear, specific, and unambiguous.
- Add structure, constraints, and expectations where helpful.

Follow this process:
1. Identify the core objective of the user.
2. Identify missing but important context.
3. Infer reasonable constraints if none are provided.
4. Define a clear role for the LLM.
5. Specify output format and quality expectations.
6. If critical information is missing, include clarification questions at the end.

OUTPUT FORMAT (strict):
---
### Enhanced Prompt
<rewrite the prompt here>

### Assumptions Made
- <list assumptions, if any>

### Clarifying Questions (if needed)
- <questions>
---`;

    // ─── State ───────────────────────────────────────────────
    let apiKey = localStorage.getItem("anthropic_api_key") || "";
    const $ = (id) => document.getElementById(id);

    // ─── Init ────────────────────────────────────────────────
    window.addEventListener("DOMContentLoaded", () => {
      if (apiKey) {
        $("apiKeyInput").value = apiKey;
        $("apiSaveBtn").textContent = "✓ Saved";
        $("apiSaveBtn").classList.add("saved");
      }

      $("promptInput").addEventListener("input", () => {
        const len = $("promptInput").value.length;
        $("charCount").textContent = len + " chars";
        const btn = $("enhanceBtn");
        if (len > 0) {
          btn.disabled = false;
          btn.classList.remove("no-input");
        } else {
          btn.disabled = true;
          btn.classList.add("no-input");
        }
      });

      $("promptInput").addEventListener("keydown", (e) => {
        if (e.key === "Enter" && (e.metaKey || e.ctrlKey)) {
          e.preventDefault();
          enhance();
        }
      });
    });

    // ─── API Key ─────────────────────────────────────────────
    function saveApiKey() {
      const key = $("apiKeyInput").value.trim();
      if (!key) return;
      apiKey = key;
      localStorage.setItem("anthropic_api_key", key);
      $("apiSaveBtn").textContent = "✓ Saved";
      $("apiSaveBtn").classList.add("saved");
      setTimeout(() => {
        $("apiSaveBtn").textContent = "Save";
        $("apiSaveBtn").classList.remove("saved");
      }, 2000);
    }

    // ─── Enhance ─────────────────────────────────────────────
    async function enhance() {
      const input = $("promptInput").value.trim();
      if (!input) return;

      if (!apiKey) {
        showError("Please add your Anthropic API key above first.");
        return;
      }

      setLoading(true);
      hideError();
      $("emptyState").style.display = "none";

      try {
        const resp = await fetch("https://api.anthropic.com/v1/messages", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-api-key": apiKey,
            "anthropic-version": "2023-06-01",
            "anthropic-dangerous-direct-browser-access": "true",
          },
          body: JSON.stringify({
            model: "claude-sonnet-4-20250514",
            max_tokens: 2048,
            system: SYSTEM_PROMPT,
            messages: [{ role: "user", content: input }],
          }),
        });

        if (!resp.ok) {
          const errData = await resp.json().catch(() => ({}));
          throw new Error(errData.error?.message || `API error ${resp.status}`);
        }

        const data = await resp.json();
        const text = data.content?.map((b) => b.text || "").join("\n") || "No response received.";
        renderResult(text);
      } catch (err) {
        showError(err.message || "Failed to enhance prompt. Please try again.");
      } finally {
        setLoading(false);
      }
    }

    // ─── UI helpers ──────────────────────────────────────────
    function setLoading(on) {
      const btn = $("enhanceBtn");
      if (on) {
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner"></span> Enhancing…';
      } else {
        btn.disabled = !$("promptInput").value.trim();
        btn.innerHTML = "✦ Enhance";
      }
    }

    function showError(msg) {
      $("errorBox").textContent = msg;
      $("errorBox").style.display = "block";
    }
    function hideError() {
      $("errorBox").style.display = "none";
    }

    function extractEnhancedPrompt(text) {
      const m = text.match(/### Enhanced Prompt\s*\n([\s\S]*?)(?=\n### |$)/);
      return m ? m[1].trim() : text;
    }

    function copyText(text, btnId) {
      navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById(btnId);
        const orig = btn.textContent;
        btn.textContent = "✓ Copied!";
        btn.classList.add("copied");
        setTimeout(() => {
          btn.textContent = orig;
          btn.classList.remove("copied");
        }, 2000);
      });
    }

    // ─── Render ──────────────────────────────────────────────
    function renderResult(text) {
      const area = $("resultArea");
      area.innerHTML = `
        <div class="card result-card">
          <div class="card-header">
            <span class="card-label">Enhanced Result</span>
            <div class="copy-btns">
              <button class="copy-btn" id="copyPromptBtn" onclick="copyText(extractEnhancedPrompt(\`${escapeTemplate(text)}\`), 'copyPromptBtn')">Copy Prompt</button>
              <button class="copy-btn" id="copyAllBtn" onclick="copyText(\`${escapeTemplate(text)}\`, 'copyAllBtn')">Copy All</button>
            </div>
          </div>
          <div class="md">${markdownToHTML(text)}</div>
        </div>
      `;
    }

    function escapeTemplate(s) {
      return s.replace(/\\/g, "\\\\").replace(/`/g, "\\`").replace(/\$/g, "\\$");
    }

    // ─── Simple Markdown → HTML ──────────────────────────────
    function markdownToHTML(text) {
      const lines = text.split("\n");
      const out = [];
      let i = 0;

      while (i < lines.length) {
        const line = lines[i];

        if (line.startsWith("### ")) {
          out.push(`<h3>${esc(line.slice(4))}</h3>`);
        } else if (line.startsWith("## ")) {
          out.push(`<h2>${esc(line.slice(3))}</h2>`);
        } else if (line.startsWith("- ")) {
          out.push("<ul>");
          while (i < lines.length && lines[i].startsWith("- ")) {
            out.push(`<li>${inline(lines[i].slice(2))}</li>`);
            i++;
          }
          out.push("</ul>");
          continue;
        } else if (line.startsWith("```")) {
          const codeLines = [];
          i++;
          while (i < lines.length && !lines[i].startsWith("```")) {
            codeLines.push(esc(lines[i]));
            i++;
          }
          out.push(`<pre><code>${codeLines.join("\n")}</code></pre>`);
          i++;
          continue;
        } else if (line === "---") {
          out.push("<hr/>");
        } else if (line.trim() === "") {
          out.push('<div class="spacer"></div>');
        } else {
          out.push(`<p>${inline(line)}</p>`);
        }
        i++;
      }
      return out.join("\n");
    }

    function esc(s) {
      return s.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
    }

    function inline(s) {
      s = esc(s);
      s = s.replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>");
      s = s.replace(/`(.+?)`/g, "<code>$1</code>");
      return s;
    }
  </script>
</body>
</html>

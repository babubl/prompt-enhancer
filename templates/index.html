<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ðŸ§  Prompt Enhancer</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <main class="container">
    <header>
      <h1>ðŸ§  Prompt Enhancer</h1>
      <p class="sub">Type your question in plain English. Get a clean, structured LLM prompt â€” instantly.</p>
    </header>

    <section class="controls">
      <label>
        Domain (optional)
        <select id="domain">
          <option value="auto">Auto</option>
          <option value="general">General</option>
          <option value="finance">Finance</option>
          <option value="coding">Coding</option>
          <option value="writing">Writing</option>
          <option value="research">Research</option>
          <option value="legal">Legal</option>
          <option value="marketing">Marketing</option>
          <option value="product">Product</option>
          <option value="education">Education</option>
          <option value="travel">Travel</option>
        </select>
      </label>

      <label>
        Tone (optional)
        <select id="tone">
          <option value="auto">Auto</option>
          <option value="concise">Concise</option>
          <option value="formal">Formal</option>
          <option value="friendly">Friendly</option>
          <option value="analytical">Analytical</option>
          <option value="persuasive">Persuasive</option>
          <option value="neutral">Neutral</option>
        </select>
      </label>
    </section>

    <section>
      <textarea id="input" placeholder="e.g., Explain NPS and tell me if it's right for a salaried person in India aged 30."></textarea>
      <button id="go">Enhance Prompt</button>
      <button id="clear" class="ghost">Clear</button>
    </section>

    <section id="results" class="hidden">
      <h2>Enhanced Prompt</h2>
      <pre id="enhanced"></pre>

      <h3>Improvements Added</h3>
      <ul id="improvements"></ul>

      <div class="actions">
        <button id="copyEnhanced">Copy Enhanced Prompt</button>
      </div>
      <div id="meta" class="muted"></div>
    </section>

    <footer>
      <small>
        Uses OpenRouter free pools with automatic fallback. If a pool is busy, you may see a brief retry.
      </small>
    </footer>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);

    $("go").addEventListener("click", async () => {
      const input = $("input").value.trim();
      const domain = $("domain").value;
      const tone = $("tone").value;

      if (!input) { alert("Please enter a prompt first."); return; }

      $("go").disabled = true;
      $("go").innerText = "Enhancingâ€¦";

      try {
        const r = await fetch("/enhance", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ input, domain, tone })
        });

        let data;
        try {
          data = await r.json();
        } catch {
          const txt = await r.text();
          throw new Error(`Non-JSON response (status ${r.status}): ${txt}`);
        }

        if (!r.ok) {
          const msg = data?.error ? `${data.error}${data.hint ? " â€” " + data.hint : ""}` : `Request failed (${r.status})`;
          throw new Error(msg);
        }

        $("results").classList.remove("hidden");
        $("enhanced").textContent = data.enhanced || "(no result)";
        const list = $("improvements"); list.innerHTML = "";
        (data.improvements || []).forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          list.appendChild(li);
        });
        $("meta").textContent = data.model_used ? `Model used: ${data.model_used}` : "";

      } catch (e) {
        console.error(e);
        alert(`Something went wrong:\n${e.message}`);
      } finally {
        $("go").disabled = false;
        $("go").innerText = "Enhance Prompt";
      }
    });

    $("clear").addEventListener("click", () => {
      $("input").value = "";
      $("results").classList.add("hidden");
      $("enhanced").textContent = "";
      $("improvements").innerHTML = "";
      $("meta").textContent = "";
    });

    $("copyEnhanced").addEventListener("click", async () => {
      const text = $("enhanced").textContent || "";
      await navigator.clipboard.writeText(text);
      alert("Enhanced prompt copied!");
    });
  </script>
</body>
</html>
